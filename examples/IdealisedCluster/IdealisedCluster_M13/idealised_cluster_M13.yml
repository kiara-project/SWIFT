# Define some meta-data about the simulation
MetaData:
  run_name:   Idealised-Cluster-M13-fid

# Define the system of units to use internally. 
InternalUnitSystem:
  UnitMass_in_cgs:     1.98841e43    # 10^10 M_sun in grams
  UnitLength_in_cgs:   3.08567758e21 # kpc in centimeters
  UnitVelocity_in_cgs: 1e5           # km/s in centimeters per second
  UnitCurrent_in_cgs:  1             # Amperes
  UnitTemp_in_cgs:     1             # Kelvin

# Parameters governing the time integration (Set dt_min and dt_max to the same value for a fixed time-step run.)
TimeIntegration:
  time_begin:        0.     # The starting time of the simulation (in internal units).
  time_end:          8.184  # The end time of the simulation 8 Gyr (in internal units).
  dt_min:            1e-16  # The minimal time-step size of the simulation (in internal units).
  dt_max:            1e-2   # The maximal time-step size of the simulation (in internal units).
  
# Parameters governing the snapshots
Snapshots:
  basename:   cluster     # Common part of the name of output files
  time_first: 0.          # (Optional) Time of the first output if non-cosmological time-integration (in internal units)
  delta_time: 0.01023     # Time difference between consecutive outputs (in internal units) 0.01023 TU = 10 Myr
  compression: 4           # Compress the snapshots
  recording_triggers_part: [-1, -1]   # Not recording as we have many snapshots
  recording_triggers_bpart: [-1, -1]  # Not recording as we have many snapshots 

# Parameters governing the conserved quantities statistics
Statistics:
  delta_time:           1.01
  scale_factor_first:   0.01

# Parameters for the self-gravity scheme
Gravity:
  eta:                         0.025     # Constant dimensionless multiplier for time integration.
  MAC:                         geometric # Use the geometric opening angle condition
  theta_cr:                    0.7       # Opening angle (Multipole acceptance criterion)
  use_tree_below_softening:    0
  max_physical_baryon_softening: 0.3     # Maximal Plummer-equivalent softening length in physical coordinates for baryon particles (in internal units).
  
# Parameters for the hydrodynamics scheme
SPH:
  resolution_eta:                    1.56   # Target smoothing length in units of the mean inter-particle separation (1.2348 == 48Ngbs with the cubic spline kernel).
  h_min_ratio:                       0.01     # Minimal smoothing length in units of softening.
  h_max:                             200.     # Maximal smoothing length in co-moving internal units.
  CFL_condition:                     0.2      # Courant-Friedrich-Levy condition for time integration.
  minimal_temperature:               100.0    # (internal units)
  particle_splitting:                1        # Particle splitting is ON
  particle_splitting_mass_threshold: 7e-4     # (internal units, i.e. 7e6 Msun ~ 4x initial gas particle mass)
  H_mass_fraction:       0.756

# Parameters of the stars neighbour search
Stars:
  resolution_eta:        1.1642     # Target smoothing length in units of the mean inter-particle separation
  h_tolerance:           7e-3
  luminosity_filename:   ./photometry
  birth_time:           -9.207      # (Optional) Initial birth times of *all* the stars to be used if we are overwriting them. (-1 means the stars remain inactive feedback-wise througout the run).
  overwrite_birth_time:  1          # (Optional) Do we want to overwrite the birth time of the stars read from the ICs? (default: 0).

Scheduler:
  max_top_level_cells:   16
  cell_split_size:       200
  
Restarts:
  onexit:       1
  delta_hours:  6.0
  max_run_time: 71.5                 # Three days minus fergie time
  resubmit_on_exit:   1
  resubmit_command:   ./resub.sh

# Parameters related to the initial conditions
InitialConditions:
  file_name:               M5_H13_fid.hdf5  # The file to read
  periodic:                0                # Are we running with periodic ICs?
  stars_smoothing_length:  0.5

# NFW potential parameters
NFWPotential:
  useabspos:          0             # 0 -> positions based on centre, 1 -> absolute positions 
  position:           [0.0,0.0,0.0] # Location of centre of the NFW potential with respect to centre of the box (internal units) if useabspos=0 otherwise with respect to the 0,0,0, coordinates.
  concentration:      7.2           # Concentration of the halo
  M_200:              1000.0        # Mass of the halo (M_200 in internal units)
  h:                  0.704         # Critical density (internal units).
  timestep_mult:      0.01          # Dimensionless pre-factor for the time-step condition, basically determines fraction of orbital time we need to do an integration step
  bulgefraction:   0.0100           # Bulge mass fraction
  epsilon: 0.3                      # Softening of the NFW potential

# Boundary particles
BoundaryParticles:
    boundary_particle_max_id:        1 # Particles with ID <= boundary_particle_max_id are treated as boundary particles.
    enable_fixed_position:           1 # Whether or not boundary particles are fixed in place.

# Impose primoridal metallicity
EAGLEChemistry:
  init_abundance_metal:     0.004457      # Inital fraction of particle mass in *all* metals 
  init_abundance_Hydrogen:  0.749796    # Inital fraction of particle mass in Hydrogen
  init_abundance_Helium:    0.245747    # Inital fraction of particle mass in Helium
  init_abundance_Carbon:    0.000788    # Inital fraction of particle mass in Carbon
  init_abundance_Nitrogen:  0.000231    # Inital fraction of particle mass in Nitrogen
  init_abundance_Oxygen:    0.001911    # Inital fraction of particle mass in Oxygen
  init_abundance_Neon:      0.000419    # Inital fraction of particle mass in Neon
  init_abundance_Magnesium: 0.000236    # Inital fraction of particle mass in Magnesium
  init_abundance_Silicon:   0.000222    # Inital fraction of particle mass in Silicon
  init_abundance_Iron:      0.000431    # Inital fraction of particle mass in Iron

# PS2020 cooling parameters
PS2020Cooling:
  dir_name:                ./UV_dust1_CR1_G1_shield1.hdf5 # Location of the cooling tables
  H_reion_z:               7.5               # Redshift of Hydrogen re-ionization (Planck 2018)
  H_reion_eV_p_H:          2.0
  He_reion_z_centre:       3.5               # Redshift of the centre of the Helium re-ionization Gaussian
  He_reion_z_sigma:        0.5               # Spread in redshift of the  Helium re-ionization Gaussian
  He_reion_eV_p_H:         2.0               # Energy inject by Helium re-ionization in electron-volt per Hydrogen atom
  delta_logTEOS_subgrid_properties: 0.3      # delta log T above the EOS below which the subgrid properties use Teq assumption
  rapid_cooling_threshold:          0.333333 # Switch to rapid cooling regime for dt / t_cool above this threshold.

# EAGLE star formation parameters
EAGLEStarFormation:
  SF_threshold:                      Subgrid      # Zdep (Schaye 2004) or Subgrid
  SF_model:                          PressureLaw  # PressureLaw (Schaye et al. 2008) or SchmidtLaw
  KS_normalisation:                  1.515e-4     # The normalization of the Kennicutt-Schmidt law in Msun / kpc^2 / yr.
  KS_exponent:                       1.4          # The exponent of the Kennicutt-Schmidt law.
  min_over_density:                  100.0        # The over-density above which star-formation is allowed.
  KS_high_density_threshold_H_p_cm3: 1e8          # Hydrogen number density above which the Kennicut-Schmidt law changes slope in Hydrogen atoms per cm^3.
  KS_high_density_exponent:          2.0          # Slope of the Kennicut-Schmidt law above the high-density threshold.
  EOS_entropy_margin_dex:            0.3          # When using Z-based SF threshold, logarithm base 10 of the maximal entropy above the EOS at which stars can form.
  threshold_norm_H_p_cm3:            0.1          # When using Z-based SF threshold, normalisation of the metal-dependant density threshold for star formation in Hydrogen atoms per cm^3.
  threshold_Z0:                      0.002        # When using Z-based SF threshold, reference metallicity (metal mass fraction) for the metal-dependant threshold for star formation.
  threshold_slope:                   -0.64        # When using Z-based SF threshold, slope of the metal-dependant star formation threshold
  threshold_max_density_H_p_cm3:     10.0         # When using Z-based SF threshold, maximal density of the metal-dependant density threshold for star formation in Hydrogen atoms per cm^3.
  threshold_temperature1_K:          1000         # When using subgrid-based SF threshold, subgrid temperature below which gas is star-forming.
  threshold_temperature2_K:          31622        # When using subgrid-based SF threshold, subgrid temperature below which gas is star-forming if also above the density limit.
  threshold_number_density_H_p_cm3:  10           # When using subgrid-based SF threshold, subgrid number density above which gas is star-forming if also below the second temperature limit.
  
# Parameters for the EAGLE "equation of state"
EAGLEEntropyFloor:
  Jeans_density_threshold_H_p_cm3: 1e-4      # Physical density above which the EAGLE Jeans limiter entropy floor kicks in expressed in Hydrogen atoms per cm^3.
  Jeans_over_density_threshold:    10.       # Overdensity above which the EAGLE Jeans limiter entropy floor can kick in.
  Jeans_temperature_norm_K:        800       # Temperature of the EAGLE Jeans limiter entropy floor at the density threshold expressed in Kelvin.
  Jeans_gamma_effective:           1.3333333 # Slope the of the EAGLE Jeans limiter entropy floor
  Cool_density_threshold_H_p_cm3: 1e-5       # Physical density above which the EAGLE Cool limiter entropy floor kicks in expressed in Hydrogen atoms per cm^3.
  Cool_over_density_threshold:    10.        # Overdensity above which the EAGLE Cool limiter entropy floor can kick in.
  Cool_temperature_norm_K:        10.        # Temperature of the EAGLE Cool limiter entropy floor at the density threshold expressed in Kelvin. (NOTE: This is below the min T and hence this floor does nothing)
  Cool_gamma_effective:           1.         # Slope the of the EAGLE Cool limiter entropy floor

# EAGLE feedback model
EAGLEFeedback:
  use_SNII_feedback:                    1               # Global switch for SNII thermal (stochastic) feedback.
  use_SNIa_feedback:                    1               # Global switch for SNIa thermal (continuous) feedback.
  use_AGB_enrichment:                   1               # Global switch for enrichement from AGB stars.
  use_SNII_enrichment:                  1               # Global switch for enrichement from SNII stars.
  use_SNIa_enrichment:                  1               # Global switch for enrichement from SNIa stars.
  filename:                             ./yieldtables/  # Path to the directory containing the EAGLE yield tables.
  IMF_min_mass_Msun:                    0.1             # Minimal stellar mass considered for the Chabrier IMF in solar masses.
  IMF_max_mass_Msun:                  100.0             # Maximal stellar mass considered for the Chabrier IMF in solar masses.
  SNII_min_mass_Msun:                   8.0             # Minimal mass considered for SNII stars in solar masses.
  SNII_max_mass_Msun:                 100.0             # Maximal mass considered for SNII stars in solar masses.
  SNII_feedback_model:                  MinimumDistance # Feedback modes: Random, Isotropic, MinimumDistance, MinimumDensity
  SNII_sampled_delay:                   1               # Sample the SNII lifetimes to do feedback.
  SNII_delta_T_K:                       3.16228e7       # Change in temperature to apply to the gas particle in a SNII thermal feedback event in Kelvin.
  SNII_energy_erg:                      1.0e51          # Energy of one SNII explosion in ergs.
  SNII_energy_fraction_function:        Independent     # Type of functional form to use for scaling the energy fraction with density and metallicity ('EAGLE', 'Separable', or 'Independent').
  SNII_energy_fraction_min:             0.5             # Minimal fraction of energy applied in a SNII feedback event.
  SNII_energy_fraction_max:             1.0             # Maximal fraction of energy applied in a SNII feedback event.
  SNII_energy_fraction_delta_E_n:       6.0             # Maximal energy increase due to high density (only used if SNII_energy_fraction_function is 'Independent').
  SNII_energy_fraction_Z_0:             0.0012663729    # Pivot point for the metallicity dependance of the SNII energy fraction (metal mass fraction).
  SNII_energy_fraction_n_0_H_p_cm3:     1.4588          # Pivot point for the birth density dependance of the SNII energy fraction in cm^-3.
  SNII_energy_fraction_n_Z:             0.8686          # Power-law for the metallicity dependance of the SNII energy fraction.
  SNII_energy_fraction_n_n:             0.8686          # Power-law for the birth density dependance of the SNII energy fraction.
  SNII_energy_fraction_use_birth_density: 0             # Are we using the density at birth to compute f_E or at feedback time?
  SNII_energy_fraction_use_birth_metallicity: 0         # Are we using the metallicity at birth to compuote f_E or at feedback time?
  SNIa_DTD:                             Exponential     # Functional form of the SNIa delay time distribution.
  SNIa_DTD_delay_Gyr:                   0.04            # Stellar age after which SNIa start in Gyr (40 Myr corresponds to stars ~ 8 Msun).
  SNIa_DTD_exp_timescale_Gyr:           2.0             # Time-scale of the exponential decay of the SNIa rates in Gyr.
  SNIa_DTD_exp_norm_p_Msun:             0.002           # Normalisation of the SNIa rates in inverse solar masses.
  SNIa_energy_erg:                     1.0e51           # Energy of one SNIa explosion in ergs.
  AGB_ejecta_velocity_km_p_s:          10.0             # Velocity of the AGB ejectas in km/s.
  stellar_evolution_age_cut_Gyr:        0.1             # Stellar age in Gyr above which the enrichment is down-sampled.
  stellar_evolution_sampling_rate:       10             # Number of time-steps in-between two enrichment events for a star above the age threshold.
  SNII_yield_factor_Hydrogen:           1.0             # (Optional) Correction factor to apply to the Hydrogen yield from the SNII channel.
  SNII_yield_factor_Helium:             1.0             # (Optional) Correction factor to apply to the Helium yield from the SNII channel.
  SNII_yield_factor_Carbon:             0.5             # (Optional) Correction factor to apply to the Carbon yield from the SNII channel.
  SNII_yield_factor_Nitrogen:           1.0             # (Optional) Correction factor to apply to the Nitrogen yield from the SNII channel.
  SNII_yield_factor_Oxygen:             1.0             # (Optional) Correction factor to apply to the Oxygen yield from the SNII channel.
  SNII_yield_factor_Neon:               1.0             # (Optional) Correction factor to apply to the Neon yield from the SNII channel.
  SNII_yield_factor_Magnesium:          2.0             # (Optional) Correction factor to apply to the Magnesium yield from the SNII channel.
  SNII_yield_factor_Silicon:            1.0             # (Optional) Correction factor to apply to the Silicon yield from the SNII channel.
  SNII_yield_factor_Iron:               0.5             # (Optional) Correction factor to apply to the Iron yield from the SNII channel.

# EAGLE AGN model
EAGLEAGN:
  subgrid_seed_mass_Msun:             1.0e4           # Black hole subgrid mass at creation time in solar masses.
  use_multi_phase_bondi:              0               # Compute Bondi rates per neighbour particle?
  use_subgrid_bondi:                  0               # Compute Bondi rates using the subgrid extrapolation of the gas properties around the BH?
  with_angmom_limiter:                0               # Are we applying the Rosas-Guevara et al. (2015) viscous time-scale reduction term?
  viscous_alpha:                      1e6             # Normalisation constant of the viscous time-scale in the accretion reduction term
  with_boost_factor:                  0               # Are we using the model from Booth & Schaye (2009)?
  boost_alpha_only:                   0               # If using the boost factor, are we using a constant boost only?
  boost_alpha:                        1.              # Lowest value for the accretion effeciency for the Booth & Schaye 2009 accretion model.
  boost_beta:                         2.              # Slope of the power law for the Booth & Schaye 2009 model, set beta to zero for constant alpha models.
  boost_n_h_star_H_p_cm3:             0.1             # Normalization of the power law for the Booth & Schaye 2009 model in cgs (cm^-3).
  with_fixed_T_near_EoS:              0               # Are we using a fixed temperature to compute the sound-speed of gas on the entropy floor in the Bondy-Hoyle accretion term?
  fixed_T_above_EoS_dex:              0.3             # Distance above the entropy floor for which we use a fixed sound-speed
  fixed_T_near_EoS_K:                 8000            # Fixed temperature assumed to compute the sound-speed of gas on the entropy floor in the Bondy-Hoyle accretion term
  radiative_efficiency:               0.1             # Fraction of the accreted mass that gets radiated.
  use_nibbling:                       1               # Continuously transfer small amounts of mass from all gas neighbours to a black hole [1] or stochastically swallow whole gas particles [0]?
  min_gas_mass_for_nibbling_Msun:     9e5             # Minimum mass for a gas particle to be nibbled from [M_Sun]. Only used if use_nibbling is 1.
  max_eddington_fraction:             1.              # Maximal allowed accretion rate in units of the Eddington rate.
  eddington_fraction_for_recording:   0.1             # Record the last time BHs reached an Eddington ratio above this threshold.
  coupling_efficiency:                0.1             # Fraction of the radiated energy that couples to the gas in feedback events.
  AGN_feedback_model:                 MinimumDistance # Feedback modes: Random, Isotropic, MinimumDistance, MinimumDensity
  AGN_use_deterministic_feedback:     1               # Deterministic (reservoir) [1] or stochastic [0] AGN feedback?
  use_variable_delta_T:               1               # Switch to enable adaptive calculation of AGN dT [1], rather than using a constant value [0].
  AGN_with_locally_adaptive_delta_T:  1               # Switch to enable additional dependence of AGN dT on local gas density and temperature (only used if use_variable_delta_T is 1).
  AGN_delta_T_mass_norm:              3e8             # Normalisation temperature of AGN dT scaling with BH subgrid mass [K] (only used if use_variable_delta_T is 1).
  AGN_delta_T_mass_reference:         1e8             # BH subgrid mass at which the normalisation temperature set above applies [M_Sun] (only used if use_variable_delta_T is 1).
  AGN_delta_T_mass_exponent:          0.666667        # Power-law index of AGN dT scaling with BH subgrid mass (only used if use_variable_delta_T is 1).
  AGN_delta_T_crit_factor:            1.0             # Multiple of critical dT for numerical efficiency (Dalla Vecchia & Schaye 2012) to use as dT floor (only used if use_variable_delta_T and AGN_with_locally_adaptive_delta_T are both 1).
  AGN_delta_T_background_factor:      0.0             # Multiple of local gas temperature to use as dT floor (only used if use_variable_delta_T and AGN_with_locally_adaptive_delta_T are both 1).
  AGN_delta_T_min:                    1e7             # Minimum allowed value of AGN dT [K] (only used if use_variable_delta_T is 1).
  AGN_delta_T_max:                    3e9             # Maximum allowed value of AGN dT [K] (only used if use_variable_delta_T is 1).
  AGN_delta_T_K:                      3.16228e8       # Change in temperature to apply to the gas particle in an AGN feedback event [K] (used if use_variable_delta_T is 0 or AGN_use_nheat_with_fixed_dT is 1 AND to initialise the BHs).
  AGN_use_nheat_with_fixed_dT:        0               # Switch to use the constant AGN dT, rather than the adaptive one, for calculating the energy reservoir threshold.
  AGN_use_adaptive_energy_reservoir_threshold: 0      # Switch to calculate an adaptive AGN energy reservoir threshold.
  AGN_num_ngb_to_heat:                1.              # Target number of gas neighbours to heat in an AGN feedback event (only used if AGN_use_adaptive_energy_reservoir_threshold is 0).
  max_reposition_mass:                1e20            # Maximal BH mass considered for BH repositioning in solar masses (large number implies we always reposition).
  max_reposition_distance_ratio:      3.0             # Maximal distance a BH can be repositioned, in units of the softening length.
  with_reposition_velocity_threshold: 0               # Should we only reposition to particles that move slowly w.r.t. the black hole?
  max_reposition_velocity_ratio:      0.5             # Maximal velocity offset of a particle to reposition a BH to, in units of the ambient sound speed of the BH. Only meaningful if with_reposition_velocity_threshold is 1.
  min_reposition_velocity_threshold: -1.0             # Minimal value of the velocity threshold for repositioning [km/s], set to < 0 for no effect. Only meaningful if with_reposition_velocity_threshold is 1.
  set_reposition_speed:               0               # Should we reposition black holes with (at most) a prescribed speed towards the potential minimum?
  with_potential_correction:          1               # Should the BH's own contribution to the potential be removed from the neighbour's potentials when looking for repositioning targets.
  threshold_major_merger:             0.333           # Mass ratio threshold to consider a BH merger as 'major'
  threshold_minor_merger:             0.1             # Mass ratio threshold to consider a BH merger as 'minor'
  merger_threshold_type:              DynamicalEscapeVelocity  # Type of velocity threshold for BH mergers ('CircularVelocity', 'EscapeVelocity', 'DynamicalEscapeVelocity').
  merger_max_distance_ratio:          3.0             # Maximal distance over which two BHs can merge, in units of the softening length.
  minimum_timestep_Myr:               0.1             # Minimum of the accretion-limited time-step length.

# Spin and jet AGN model (Husko et al. 2022)
SPINJETAGN:
  subgrid_seed_mass_Msun:             1.0e4           # Black hole subgrid mass at creation time in solar masses.
  use_multi_phase_bondi:              0               # Compute Bondi rates per neighbour particle?
  with_angmom_limiter:                0               # Are we applying the Rosas-Guevara et al. (2015) viscous time-scale reduction term?
  with_boost_factor:                  0               # Are we using the model from Booth & Schaye (2009)?
  with_fixed_T_near_EoS:              0               # Are we using a fixed temperature to compute the sound-speed of gas on the entropy floor in the Bondy-Hoyle accretion term?
  use_krumholz:                       0               # Whether to use Krumholz suppression of the Bondi accretion rate
  use_subgrid_gas_properties:         1               # Subgrid extrapolation of gas properties around the BH
  use_nibbling:                       1               # Continuously transfer small amounts of mass from all gas neighbours to a black hole [1] or stochastically swallow whole gas particles [0]?
  with_krumholz_vorticity:            0
  min_gas_mass_for_nibbling_Msun:     3e6             # Minimum mass for a gas particle to be nibbled from [M_Sun]. Only used if use_nibbling is 1.
  max_eddington_fraction:             1.              # Maximal allowed accretion rate in units of the Eddington rate.
  eddington_fraction_for_recording:   0.1             # Record the last time BHs reached an Eddington ratio above this threshold.
  coupling_efficiency:                0.1             # Fraction of the radiated energy that couples to the gas in feedback events.
  AGN_feedback_model:                 MinimumDistance # Feedback modes: Random, Isotropic, MinimumDistance, MinimumDensity
  AGN_use_deterministic_feedback:     1               # Deterministic (reservoir) [1] or stochastic [0] AGN feedback?
  AGN_delta_T_K:                      3.16228e8       # Change in temperature to apply to the gas particle in an AGN feedback event [K] (used if use_variable_delta_T is 0 or AGN_use_nheat_with_fixed_dT is 1 AND to initialise the BHs).
  AGN_heating_temperature_model:      Constant        # How AGN heating temperatures are calculated. If 'Constant', a single value is used. If 'BlackHoleMass', then an empirical relation between halo mass and black hole mass is used to calculate delta_T. 'HaloMass' is currently not supported.
  AGN_num_ngb_to_heat:                1.              # Target number of gas neighbours to heat in an AGN feedback event (only used if AGN_use_adaptive_energy_reservoir_threshold is 0).
  AGN_delta_T_model:                  Constant        # How AGN heating temperatures are calculated. If 'Constant', a single value is used. If 'BlackHoleMass', then an empirical relation between halo mass and black hole mass is used to calculate delta_T. 'HaloMass' is currently not supported.
  max_reposition_distance_ratio:      3.0             # Maximal distance a BH can be repositioned, in units of the softening length.
  with_reposition_velocity_threshold: 0               # Should we only reposition to particles that move slowly w.r.t. the black hole?
  set_reposition_speed:               0               # Should we reposition black holes with (at most) a prescribed speed towards the potential minimum?
  with_potential_correction:          1               # Should the BH's own contribution to the potential be removed from the neighbour's potentials when looking for repositioning targets.
  threshold_major_merger:             0.333           # Mass ratio threshold to consider a BH merger as 'major'
  threshold_minor_merger:             0.1             # Mass ratio threshold to consider a BH merger as 'minor'
  merger_threshold_type:              DynamicalEscapeVelocity  # Type of velocity threshold for BH mergers ('CircularVelocity', 'EscapeVelocity', 'DynamicalEscapeVelocity').
  merger_max_distance_ratio:          3.0             # Maximal distance over which two BHs can merge, in units of the softening length.
  include_jets:                       1               # Global switch whether to include jet feedback [1] or not [0].
  turn_off_radiative_feedback:        1               # Global switch whether to turn off radiative (thermal) feedback [1] or not [0]. This should only be used if 'include_jets' is set to 1, since we want feedback in some form or another.
  alpha_acc:                          0.2             # Viscous alpha of the subgrid accretion disks. Likely to be within the 0.1-0.3 range. The main effect is that it sets the transition accretion rate between the thin and thick disk, as dot(m) = 0.2 * alpha^2.
  mdot_crit_ADAF:                     0.01            # The transition normalized accretion rate (Eddington ratio) at which the disc goes from thick (low accretion rates) to thin (high accretion rates). The feedback also changes from kinetic jets to thermal isotropic, respectively.
  seed_spin:                          0.01            # The (randomly-directed) black hole spin assigned to BHs when they are seeded. Should be strictly between 0 and 1.
  AGN_jet_velocity_model:             Constant        # How AGN jet velocities are calculated. If 'Constant', a single value is used. If 'BlackHoleMass', then an empirical relation between halo mass and black hole mass is used to calculate jet velocities. 'HaloMass' is currently not supported. 
  v_jet_km_p_s:                       15000.          # Jet velocity to use if 'AGN_jet_velocity_model' is 'Constant'. Units are km/s.
  opening_angle_in_degrees:           7.5             # The half-opening angle of the jet in degrees. Should use values < 15 unless for tests.
  N_jet:                              2               # Target number of particles to kick as part of a single jet feedback event. Should be a multiple of 2 to ensure approximate momentum conservation (we always kick particles in pairs, one from each 'side' of the BH, relative to the spin vector).
  AGN_jet_feedback_model:             MinimumDistance # Which particles to kick from the black hole smoothing kernels. Should be 'SpinAxis', 'MinimumDistance', 'MaximumDistance' or 'MinimumDensity'
  eps_f_jet:                          1.              # Coupling efficiency for jet feedback. No reason to expect this to be less than 1.
  fix_jet_efficiency:                 0               # Global switch whether to fix jet efficiency to a particular value [1], or use a spin-dependant formula [0].
  jet_efficiency:                     0.1             # The constant jet efficiency used if 'fix_jet_efficiency' is set to 1.
  fix_jet_direction:                  0               # Global switch whether to fix the jet direction to be along the z-axis, instead of along the spin vector.
  accretion_efficiency_mode:          Constant        # How the accretion efficiencies are calculated for the thick accretion disc. If 'Constant', the value of 'accretion_efficiency_thick' will be used. If 'Variable', the accretion efficiency will scale with Eddington ratio.
  accretion_efficiency_thick:         0.01            # The accretion efficiency (suppression factor of the accretion rate) to use in the thick disc (ADAF), to represent the effects of subgrid ADIOS winds that take away most of the mass flowing through the accretion disc.
  accretion_efficiency_slim:          1               # The constant accretion efficiency to use in the slim disc, at super-Eddington rates.
  fix_radiative_efficiency:           0               # Global switch whether to fix the radiative efficiency to a particular value [1], or use a spin-dependant formula [0]. 
  max_reposition_mass_Msun:           1e-20           # Maximum mass, in Msun, of BHs to which repositioning will be applied.
  radiative_efficiency:               0.1             # The constant jet efficiency used if 'fix_radiative_efficiency' is set to 1. Otherwise, this value is used to define the Eddington accretion rate.
  TD_region:                          B               # How to treat the subgrid accretion disk if it is thin, according to the Shakura & Sunyaev (1973) model. If set to B, region b will be used. If set to C, region c will be used.
  delta_ADAF:                         0.2             # Electron heating parameter, which controls the strength of radiative feedback in thick disks. Should be between 0.1 and 0.5. This parameter is only used if turn_off_secondary_feedback is set to 0.
  include_slim_disk:                  0               # Global switch whether to include super-Eddington accretion, modeled as the slim disk. If set to 0, disks will be considered thin even at very large accretion rates.
  use_jets_in_thin_disc:              0               # Whether to use jets alongside radiation in the thin disc at moderate Eddington ratios.
  use_ADIOS_winds:                    0               # Whether to include ADIOS winds in the thick disc as thermal isotropic feedback (same channel as thin disc quasar feedback, but with a different efficiency). 
  slim_disc_wind_factor:              0               # The relative efficiency of slim disc winds at super-Eddington rates. If '1', full winds will be used, while '0' will lead to no winds. Any value in between those can also be used. The wind is implemented in the thermal isotropic feedback channel.
  minimum_timestep_yr:                1e5

KIARAChemistry:
  diffusion_on:                 1                       # Turns on metal mixing
  diffusion_coefficient:        0.236                   # 0.472 is default value from Rennehan (2021), they quote C*h^2*|S| not (C*h)^2|S|
  use_firehose_wind_model:      1                       # Turns on Firehose wind model (tracks outflow stream/ambient mixing when "decoupled")
  firehose_nh_ambient_max_cgs:  1.e-3
  firehose_temp_floor:          1.e3
  firehose_recoupling_mach:     1.0
  firehose_recoupling_u_factor: 3.0
  firehose_recoupling_fmix:     0.899
  firehose_max_velocity:        2000.0
  firehose_max_fmix_per_step:   0.1
  init_abundance_metal:         0.004457
  init_abundance_Hydrogen:      0.749796
  init_abundance_Helium:        0.245747
  init_abundance_Carbon:        0.000788
  init_abundance_Nitrogen:      0.000231
  init_abundance_Oxygen:        0.001911
  init_abundance_Neon:          0.000419
  init_abundance_Magnesium:     0.000236
  init_abundance_Silicon:       0.000222
  init_abundance_Sulfur:        1.e-5
  init_abundance_Calcium:       1.e-5
  init_abundance_Iron:          0.000431

# SIMBA Cooling using Grackle-3.2+
KIARACooling:
  cloudy_table:                 CloudyData_UVB=FG2011_shielded.h5  # Name of the Cloudy Table (available on the grackle bitbucket repository)
  with_UV_background:           1                       # Enable or not the UV background
  redshift:                     -1                      # Redshift to use (-1 means time based redshift)
  with_metal_cooling:           1                       # Enable or not the metal cooling
  provide_volumetric_heating_rates: 0                   # Provide volumetric heating rates to grackle
  provide_specific_heating_rates: 1                     # Provide specific heating rates to grackle; turning this off ignores adiabatic dudt
  self_shielding_method:        4                       # Grackle (<= 3) self shielding method; 3 (default) is advised.
  ism_adiabatic_heating_method: 1                       # 0=ignore adiabatic du/dt, 1=evolve in grackle, 2=use to evaporate cold ism
  grackle_max_steps:            300                     # maximum number of iterations for a single step in Grackle
  timestep_accuracy:            0.2                     # max change in energy, HI, or electron density in a single timestep
  grackle_damping_interval:     0                       # e-folding of damping subcycle iterations when substep too small (0=off)
  thermal_time:                 0                       # Don't cool again within this many Myr
  use_grackle_dust_evol:        1                       # turn on dust model, only in KIARA (will be turned off for SIMBA's GRACKLE_MODE==1)
  dust_destruction_eff:         0.3                     # efficiency of dust destruction by shocks = destroyed mass/shocked mass
  dust_sne_coeff:               1.0                     # SN energy / 1.e51 erg
  dust_sne_shockspeed:          100.0                   # km/s
  dust_grainsize:               0.1                     # grain size in micron
  dust_growth_densref:          3.346e-22               # g cm^-3 physical
  dust_growth_tauref:           1.0                     # Gyr, growth timescale at densref
  cold_ISM_frac:                0.5                     # Fraction of particle mass in cold phase eligible for SF
  G0_computation_method:        1                       # For Grackle subgrid SF compate G0 via: 1=Local SFR density; 2=Global sSFR; 3=sSFR when nonzero, otherwise local; 4=scaled to local SNe rate; 5=mix of 2+4
  max_subgrid_density_g_p_cm3:  1.673e-19               # z=0 maximum comoving density sent to Grackle in subgrid model, in cgs units
  entropy_floor_margin_dex:     0.5                     # log interval above entropy floor allowed to be in subgrid model 
  self_enrichment_metallicity:  1.e-7                   # when below this metallicity, self-enrich from own star formation.

# KIARA star formation parameters
KIARAStarFormation:
  SF_model:                          WadaNorman         # SchmidtLaw, WadaNorman, or lognormal
  min_over_density:                  100.0              # The over-density above which star-formation is allowed.
  threshold_temperature_K :          1000.0             # When using subgrid-based SF threshold, subgrid temperature below which gas is star-forming if also above the density limit.
  threshold_number_density_H_p_cm3:  0.13              # When using subgrid-based SF threshold, subgrid number density above which gas is star-forming if also below the temperature limit.
  H2_model:                          Grackle            # 'Thresh' sets fH2=1; 'KMT' computes fH2 from KG11; 'Grackle' uses Grackle-computed fH2
  lognormal_critical_density:        1.e3               # For WN/lognormal: number density (cgs) above which SF occurs
  lognormal_epsilon:                 1.0              # 
  wn07_epsc_method:                  4                  # method to estimate SF eff epsc from galaxy props in WadaNorman model

# Parameters for the SIMBA "equation of state"
SIMBAEntropyFloor:
  Jeans_density_threshold_H_p_cm3:      0.13            # Physical density above which the SIMBA Jeans limiter entropy floor kicks in expressed in Hydrogen atoms per cm^3.
  Jeans_over_density_threshold:         100.            # Overdensity above which the SIMBA Jeans limiter entropy floor can kick in.
  Jeans_temperature_norm_K:             8000            # Temperature of the SIMBA Jeans limiter entropy floor at the density threshold expressed in Kelvin.
  Jeans_gamma_effective:                1.3333          # Slope the of the SIMBA Jeans limiter entropy floor
  Cool_density_threshold_H_p_cm3:       0.13e-3         # Physical density for the SIMBA Cool limiter entropy floor kicks in expressed in Hydrogen atoms per cm^3, between this value up to Jeans_density_threshold_H_p_cm3.
  Cool_over_density_threshold:          1.              # Overdensity above which the SIMBA Cool limiter entropy floor can kick in.
  Cool_temperature_norm_K:              100             # Temperature of the SIMBA Cool limiter entropy floor at the density threshold expressed in Kelvin. (NOTE: This is below the min T and hence this floor does nothing)
  Cool_gamma_effective:                 1.0             # Slope the of the SIMBA Cool limiter entropy floor

# Kiara feedback model (based on EAGLE-kinetic)
KIARAFeedback:
  tables_path:                          ./chem5         #
  imf:                                  1               # IMF: 0 = Kroupa, 1 = Chabrier, >=2 Not implemented
  use_HN_energy_from_chem5:             0               # Use hypernovae energy directly from star particle to gas
  use_SNII_energy_from_chem5:           0               # Use SNII energy directly from star particle to gas
  use_SNIa_energy_from_chem5:           500             # Use SNIa energy directly from star particle to gas. If >10, use SNIa energy only if age < use_SNIa_energy_from_chem5 in Myr
  dust_boost_factor:                    1.
  stellar_enrichment_frequency:         0.0             # Factor in units of current stellar age above which to recompute stellar evol
  metal_yield_multiplier:               1.5            # Factor to multiply all chem5 metal yields
  kick_direction_flag:                  2               # Direction of launch: 0=random, 1=L_gas(=v x a), 2=outwards
  FIRE_velocity_normalization:          3.0             # Normalization from Muratov
  FIRE_velocity_slope:                  0.12            # Muratov+15: 0.12
  kick_velocity_scatter:                0.1             #
  FIRE_eta_normalization:               9.0            #
  FIRE_eta_break_Msun:                  5.2e9           #
  FIRE_eta_lower_slope:                 -0.4            # Angles-Alcazar+17: -0.317
  FIRE_eta_upper_slope:                 -0.761          # Angles-Alcazar+17: -0.761
  FIRE_eta_lower_slope_EOR:             -0.4            # Angles-Alcazar+17: -0.317
  wind_velocity_suppression_redshift:   -8.            # above this redshift, FIRE_velocity_normalization is attenuated by (1+z)^2
  wind_eta_suppression_redshift:        -8.
  metal_dependent_vwind:                2               # 0=Off, 1=vwind boost, 2=eta boost, 3=both boost
  cold_wind_temperature_K:              8000            #
  hot_wind_temperature_K:               8000            # converted to K from erg/g released by 1 SN per ~100Mo
  minimum_galaxy_stellar_mass_Msun:     5.8e8           # floor for M* to use in FIRE wind formula
  wind_decouple_time_factor:            0.1            # fraction of Hubble time at launch to decouple (max)
  recouple_ism_density_nH_cgs:          0.1            # ISM threshold density for purposes of recoupling (cgs)
  recouple_density_factor:              0.001            # Factor below recouple_ism_density_cgs at which to recouple
  SNII_energy_multiplier:               1.0
  stellar_evolution_age_cut_Gyr:        0.5             # Stellar age in Gyr above which the enrichment is down-sampled.
  stellar_evolution_sampling_rate:      10              # Number of time-steps in-between two enrichment events for a star above the age threshold.
  early_stellar_feedback_alpha:         0.8             # ESF model of Keller+22. Should be [0.5-1]. 0=off
  SNIa_add_heat_to_ISM:                 1

  # Obsidian: Rennehan+24 AGN model
ObsidianAGN:
  subgrid_seed_mass_Msun:               1.0e4           # Black hole subgrid mass at creation time in solar masses.
  seed_during_star_formation:           0               # Unimplemented
  seed_n_H_threshold_cgs:               0.0             # Unimplemented
  seed_temperature_threshold_cgs:       0.0             # Unimplemented
  seed_metallicity_threshold:           0.0             # Unimplemented
  environment_temperature_cut_K:        1.0e5           # Above this is considered "hot gas"
  use_nibbling:                         1               # Continuously transfer small amounts of mass from all gas neighbours to a black hole [1] or stochastically swallow whole gas particles [0]?
  min_gas_mass_for_nibbling_Msun:       1.e6           # Minimum mass for a gas particle to be nibbled from [M_Sun]. Only used if use_nibbling is 1.
  bondi_use_all_gas:                    0               # Use all of the gas in the kernel to compute the Bondi rate
  bondi_alpha:                          0.1             # The boost factor for Bondi accretion
  max_eddington_fraction:               5.           # Maximal allowed total accretion rate in units of Eddington rate.
  max_bondi_eddington_fraction:         0.1           # Maximal allowed Bondi accretion rate in units of Eddington rate.
  eddington_fraction_lower_boundary:    0.03            # Below this M_dot,acc/M_dot,Edd, the ADAF mode starts
  eddington_fraction_upper_boundary:    0.3             # Above this M_dot,acc/M_dot,Edd, the slim disk mode starts
  fixed_T_above_EoS_dex:                0.5             # How far above the EoS should we consider cold gas?
  torque_accretion_method:              3              # 0=Mgas/tdyn on corotating gas 1=Mgas/tdyn on all gas, 2=Simba (HQ11), 3=Mgas/tdyn on cold gas
  torque_accretion_norm:                0.06           # Multiplicative factor for the cold gas accreiton mode
  dynamical_time_calculation_method:    0
  dynamical_time_factor:                1.           # Number of dynamical times over which mass is accreted onto BH
  dynamical_time_max_in_Myr:            100.         # Maximum dynamical time for BH accretion in Myr at z=0, scaled by H0/H(z).
  suppress_growth:                      4            # 0=None, 1=Hopkins+21, 2=Simba-style exponential to torque mode only, 3=Simba-style applied to all accretion, 4=SF outflow-based, 5=4 applied only to SF gas, 6=2 applied only to SF gas
  suppression_sf_eff:                   0.35           # SF efficiency within BH accretion region; <0 means compute from BH kernel, capped at fabs(value)
  tdyn_sigma:                           0.0             # spread in accretion times (sampled from +ive Gaussian) relatively to tdyn
  sigma_crit_Msun_pc2:                  3000        # critical mass surface density for Hopkins+21 suppression, canonical=3000
  bh_characteristic_suppression_mass:   -3.e7            # the exponential e-folding mass for Simba-C style BH suppression
  jet_loading_type:                     MixedLoaded    # EnergyLoaded or MomentumLoaded
  jet_frac_energy_loaded:               0.1
  jet_temperature_K:                    -1.0          # Temperature to heat the jet particles, in Kelvin. If <0, use abs(value) times Tvir (estimated from MBH)
  jet_velocity_km_s:                    7000.         # Resolved, large-scale jet velocity in km/s. Negative means scale with H^1/3 (i.e. like an escape velocity)
  jet_subgrid_velocity_km_s:            50000.          # Subgrid jet velocity in km/s, sets the small-scale mass loading.
  jet_velocity_scaling_with_BH_mass:    0.0             # power-law scaling of jet vel with (MBH/1.e8 Mo)
  jet_velocity_scaling_with_BH_lum:     0.0             # power-law scaling of jet vel with (LBH/1.e45 erg/s)
  jet_launch_dir:                       1               # Direction of launch: 0=random, 1=L_gas, 2=L_BH, 3=outwards
  jet_minimum_reservoir_mass_Msun:      3.6e7           # How much mass must build up in the reservoir before the jet releases energy. Should be ~2 times the particle mass.
  lum_thresh_always_jet_1e45_erg_s:     0.              # If BH accr rate gives a luminosity above this in units of 10^45 erg/s, always launch a jet (0=off)
  jet_decouple_time_factor:             0.e-4          # decoupling time in units of t_Hubble
  fixed_spin:                           0.9             # The spin of every black hole in the simulation.
  adaf_coupling:                        0.1             # How much of the energy couples to the medium (at z=0). <1
  adaf_z_scaling:                       3.             # power-law scaling of adaf_coupling value with (1+z) (default=0; adaf_coupling capped at 1)
  adaf_disk_efficiency:                 0.002           # Constant value from Benson & Babul 2009 Fig. 7
  adaf_wind_speed_km_s:                 2000.           # Max wind speed for ADAF kick
  adaf_f_quasar_psi:                    -1.
  adaf_maximum_temperature_K:           -1.0           # The maximum temperature to heat an individual particle in the ADAF thermal energy dump; If <0, use abs(value) times Tvir (estimated from MBH)
  adaf_mass_limit_Msun:                 2.e8           # Minimum black hole mass (Msun) for the ADAF mode to activate
  adaf_mass_limit_spread_Msun:          2.e7
  adaf_mass_limit_a_scaling:            1.0
  adaf_mass_limit_a_max:                0.1
  adaf_cooling_shutoff_factor:          0.0            # shut of cooling around ADAF BH for this * min(h/c_s, dt_bh). -1 puts half ADAF energy into heat (no cooling shutoff) + half into kick, similar to SIMBA.
  adaf_kick_factor:                     0.8              # frac of ADAF energy to use in kick (as opposed to  heating)
  adaf_wind_dir:                        3               # Direction of launch: 0=random, 1=L_gas, 2=L_BH, 3=outwards
  adaf_decouple_time_factor:            0              # decoupling time in units of t_Hubble
  quasar_coupling:                      0.05              # How much of the energy couples to the medium. <1
  quasar_wind_momentum_flux:            20.0            # This number times L/c for momentum loading.
  quasar_wind_speed_km_s:               -500.           # Wind launch velocity.
  quasar_wind_dir:                      1               # Direction of launch: 0=random, 1=L_gas, 2=L_BH, 3=outwards
  quasar_lum_thresh_1e45_erg_s:         1.0             # above this luminosity (in erg/s), quasar_coupling increases linearly w/lum up to 1.
  quasar_decouple_time_factor:          1.e-3          # decoupling time in units of t_Hubble
  minimum_black_hole_mass_v_kick_Msun:  1.e7
  slim_disk_coupling:                   0.05             # How much of the energy couples to the medium. <1
  slim_disk_jet_active:                 0               # Should we also have a jet in the slim disk mode?
  slim_disk_wind_dir:                   1               # Direction of launch: 0=random, 1=L_gas, 2=L_BH, 3=outwards
  slim_disk_decouple_time_factor:       1.e-3          # decoupling time in units of t_Hubble
  minimum_black_hole_mass_unresolved_Msun: 1.8e7            # BH mass above which resolved feedback is viable (~m_gas)
  reposition_with_dynamical_friction:   0               # Unimplemented
  max_reposition_mass:                  1e20            # Maximal BH mass considered for BH repositioning in solar masses (large number implies we always reposition).
  max_reposition_distance_ratio:        1.2             # Maximal distance a BH can be repositioned, in units of the softening length.
  with_reposition_velocity_threshold:   0               # Should we only reposition to particles that move slowly w.r.t. the black hole?
  max_reposition_velocity_ratio:        0.5             # Maximal velocity offset of a particle to reposition a BH to, in units of the ambient sound speed of the BH. Only meaningful if with_reposition_velocity_threshold is 1.
  min_reposition_velocity_threshold:    -1.0            # Minimal value of the velocity threshold for repositioning [km/s], set to < 0 for no effect. Only meaningful if with_reposition_velocity_threshold is 1.
  set_reposition_speed:                 0               # Should we reposition black holes with (at most) a prescribed speed towards the potential minimum?
  reposition_reference_mass:            0               # Unused, normalisation for speed of repositioning.
  reposition_reference_n_H:             0               # Unused, reference density for speed of repositioning.
  reposition_coefficient_upsilon:       0               # Unused, normalisation factor.
  threshold_major_merger:               0.333           # Mass ratio threshold to consider a BH merger as 'major'
  threshold_minor_merger:               0.1             # Mass ratio threshold to consider a BH merger as 'minor'
  merger_threshold_type:                CircularVelocity  # Type of velocity threshold for BH mergers (0: v_circ at kernel edge, 1: v_esc at actual distance, with softening, 2: v_esc at actual distance, no softening).
  merger_max_distance_ratio:            1.2             # Maximal distance over which two BHs can merge, in units of the softening length.
  with_potential_correction:            1               # Correct for the potential when repositioning?
  minimum_timestep_Myr:                 0.1             # Minimum of the accretion-limited time-step length.
  dt_accretion_factor:                  1.0            # OPTIONAL: Default 1.0, timestep limiter 5% growth

